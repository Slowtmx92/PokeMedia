<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Pok√©Media v9.9.6 ‚Äî Bio-Terminal Elite</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root{--bg:#020617;--card:#111827;--text:#e5e7eb;--accent:#22c55e;--accent-glow:rgba(34, 197, 94, 0.4);--danger:#ef4444;--shiny:#facc15;}
        *{box-sizing:border-box; transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);}
        body{margin:0;font-family: 'Segoe UI', system-ui, sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;}
        
        nav { background: #0f172a; display: flex; justify-content: center; gap: 15px; padding: 1rem; position: sticky; top: 0; z-index: 1000; border-bottom: 2px solid var(--accent); box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
        .nav-link { color: white; border:none; background:transparent; font-weight: bold; padding: 10px 20px; border-radius: 10px; cursor: pointer; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px; }
        .nav-link.active { background: var(--accent); color: black; box-shadow: 0 0 15px var(--accent-glow); }

        .page { display: none; padding: 20px; max-width: 1400px; margin: auto; animation: slideIn 0.5s ease; }
        .page.active { display: block; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- INTRO NARRATIVE V9.9.6 --- */
        .intro-header { 
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.98), rgba(30, 41, 59, 0.8)); 
            padding: 3.5rem; border-radius: 40px; margin-bottom: 2.5rem; 
            border: 1px solid rgba(34, 197, 94, 0.1); position: relative; 
            border-left: 10px solid var(--accent); overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
            animation: borderPulse 4s infinite;
        }
        @keyframes borderPulse { 0%, 100% { border-left-color: var(--accent); } 50% { border-left-color: #4ade80; } }

        .intro-header::before {
            content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(34, 197, 94, 0.03) 0%, transparent 70%);
            animation: rotateBg 20s linear infinite; z-index: 0;
        }
        @keyframes rotateBg { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .intro-content { position: relative; z-index: 1; }
        .version-tag { background: var(--accent); color: black; padding: 4px 12px; border-radius: 6px; font-weight: 900; font-size: 0.7rem; vertical-align: middle; margin-left: 15px; box-shadow: 0 0 15px var(--accent); }
        .intro-header h1 { margin: 0; font-size: 3.8rem; color: #fff; text-transform: uppercase; letter-spacing: -3px; text-shadow: 0 0 20px var(--accent-glow); }
        .intro-desc { font-size: 1.2rem; color: #94a3b8; margin: 25px 0; line-height: 1.8; max-width: 950px; }
        .intro-desc b { color: var(--accent); text-shadow: 0 0 5px var(--accent-glow); }

        .status-bar { display: flex; gap: 20px; margin-bottom: 25px; }
        .status-item { font-size: 0.75rem; font-weight: bold; letter-spacing: 2px; display: flex; align-items: center; gap: 8px; color: #64748b; }
        .dot { width: 10px; height: 10px; background: var(--accent); border-radius: 50%; display: inline-block; animation: blink 1s infinite; box-shadow: 0 0 10px var(--accent); }
        @keyframes blink { 0%, 100% { opacity: 1; transform: scale(1.1); } 50% { opacity: 0.3; transform: scale(0.9); } }

        /* --- FILTRES & GRID --- */
        .controls-panel { background: #0f172a; border-radius: 24px; margin-bottom: 2rem; border: 1px solid rgba(255,255,255,0.05); padding: 1.5rem; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .search-row { display: flex; gap: 15px; margin-bottom: 15px; }
        input { flex: 3; padding: 18px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.1); background: #1e293b; color: white; outline: none; font-size: 1rem; }
        select { flex: 1.5; padding: 18px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.1); background: #1e293b; color: white; cursor: pointer; }
        .btn-reset { background: #1e293b; color: var(--danger); border: 2px solid var(--danger); padding: 0 25px; border-radius: 14px; cursor: pointer; font-weight: 900; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; }
        
        .chips-list { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        .chip { padding: 10px 20px; border-radius: 20px; background: #1e293b; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; font-size: 0.85rem; font-weight: bold; color: #64748b; }
        .chip.active { background: var(--accent); color: black; box-shadow: 0 5px 15px var(--accent-glow); }

        #grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap: 2rem; }
        .card { border-radius: 40px; padding: 1.8rem; text-align: center; cursor: pointer; height: 420px; display: flex; flex-direction: column; align-items: center; justify-content: space-between; border: 2px solid rgba(255,255,255,0.05); position: relative; overflow: hidden; background: #111827; }
        .card img { width: 175px; height: 175px; z-index: 2; filter: drop-shadow(0 15px 25px rgba(0,0,0,0.6)); }
        
        .card-info { width: 100%; background: rgba(15, 23, 42, 0.9); padding: 15px; border-radius: 25px; backdrop-filter: blur(12px); z-index: 2; border: 1px solid rgba(255,255,255,0.1); }
        .type-tag { display: inline-block; padding: 5px 12px; border-radius: 10px; font-size: 0.65rem; font-weight: 800; color: white; text-transform: uppercase; margin: 2px; }
        .form-label { position: absolute; top: 20px; right: 20px; background: rgba(34, 197, 94, 0.2); backdrop-filter: blur(5px); color: var(--accent); padding: 5px 12px; border-radius: 20px; font-size: 0.65rem; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; border: 1px solid var(--accent); z-index: 5; }

        #modal { position: fixed; inset: 0; background: rgba(2, 6, 23, 0.98); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; backdrop-filter: blur(15px); }
        .modal-inner { background: #0f172a; padding: 3rem; border-radius: 55px; width: 100%; max-width: 550px; text-align: center; border: 1px solid var(--accent); max-height: 90vh; overflow-y: auto; }
        
        .shiny-toggle { background: #1e293b; color: white; border: 1px solid var(--accent); padding: 14px 28px; border-radius: 25px; cursor: pointer; font-weight: bold; margin-bottom: 20px; font-size: 0.85rem; letter-spacing: 1px; }
        .shiny-toggle.active { background: var(--shiny); color: black; border-color: var(--shiny); box-shadow: 0 0 20px rgba(250, 204, 21, 0.3); }

        .pagination { display: flex; justify-content: center; gap: 12px; margin: 5rem 0; flex-wrap: wrap; }
        .p-btn { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; background: #1e293b; border-radius: 15px; cursor: pointer; font-weight: bold; border: 1px solid rgba(255,255,255,0.1); }
        .p-btn.active { background: var(--accent); color: black; }
    </style>
</head>
<body>

<nav>
    <button class="nav-link active" onclick="showTab('pokedex', this)">üìï Encyclop√©die</button>
    <button class="nav-link" onclick="showTab('quiz', this); resetQuiz()">‚ùì Module Quiz</button>
</nav>

<div id="pokedex" class="page active">
    <div class="intro-header">
        <div class="intro-content">
            <div class="status-bar">
                <div class="status-item" style="color:var(--accent)"><span class="dot"></span> SYSTEM ONLINE</div>
                <div class="status-item">DB_VER: 9.9.6</div>
                <div class="status-item">STATUS: SECURE</div>
            </div>
            <h1>Pok√©Media<span class="version-tag">V9.9.6</span></h1>
            <div class="intro-desc">
                Analyse corrective termin√©e. Protocole <b>Deep-Search X/Y</b> activ√©. Indexation des <b>Tauros de Paldea</b> et des sp√©cimens <b>Infinimax</b> valid√©e. 
                Le filtrage par puce isole d√©sormais les mutations sans redondance dans l'index principal.
            </div>
            <div style="display:flex; gap:40px; margin-top:20px;">
                <div><small style="display:block; color:var(--accent); font-weight:bold; font-size:0.65rem; letter-spacing:1px;">FLUX DE DONN√âES</small><strong id="st-total" style="font-size:1.8rem;">0</strong></div>
                <div><small style="display:block; color:var(--accent); font-weight:bold; font-size:0.65rem; letter-spacing:1px;">LATENCE S√âQUENCE</small><strong style="font-size:1.8rem;">4ms</strong></div>
            </div>
        </div>
    </div>

    <div class="controls-panel">
        <div class="search-row">
            <input id="search" placeholder="Nom, forme ou type pour analyse..." oninput="currentPage=1;render()">
            <select id="region" onchange="currentPage=1;render()">
                <option value="all">Index National</option>
                <option value="899-1025">Paldea</option>
                <option value="1-151">Kanto</option>
                <option value="152-251">Johto</option>
                <option value="252-386">Hoenn</option>
                <option value="387-493">Sinnoh</option>
                <option value="494-649">Unys</option>
                <option value="650-721">Kalos</option>
                <option value="722-809">Alola</option>
                <option value="810-898">Galar</option>
            </select>
            <button class="btn-reset" onclick="resetAll()">RESET</button>
        </div>
        <div class="chips-list" id="filter-box"></div>
    </div>
    
    <div id="grid"></div>
    <div id="pagination" class="pagination"></div>
</div>

<div id="quiz" class="page">
    <div style="text-align:center; padding: 60px;">
        <h2 style="color:var(--accent); letter-spacing:4px;">D√âCRYPTAGE VISUEL</h2>
        <img id="q-img" style="width:280px; filter:brightness(0); transition:0.8s; margin-bottom:40px;">
        <div id="q-opts" style="display:grid; grid-template-columns:1fr 1fr; gap:25px; max-width:650px; margin:auto;"></div>
        <button id="q-next" onclick="resetQuiz()" style="display:none; margin-top:40px; padding:20px 50px; background:var(--accent); border:none; border-radius:18px; cursor:pointer;">CIBLE SUIVANTE</button>
    </div>
</div>

<div id="modal" onclick="this.style.display='none'"><div class="modal-inner" onclick="event.stopPropagation()" id="m-content"></div></div>

<script>
/** * CONFIGURATION ET √âTAT GLOBAL V9.9.6 */
let allPk = [], currentPage = 1, perPage = 48, activeFilter = null;
let sImg = { n: "", s: "", is: false };

const tMap = {fire:'Feu',water:'Eau',grass:'Plante',normal:'Normal',electric:'Electrik',fighting:'Combat',poison:'Poison',ground:'Sol',flying:'Vol',psychic:'Psy',bug:'Insecte',rock:'Roche',ghost:'Spectre',dragon:'Dragon',dark:'T√©n√®bres',steel:'Acier',fairy:'F√©e',ice:'Glace'};
const cMap = {Feu:'#EE8130',Eau:'#6390F0',Plante:'#7AC74C',Normal:'#A8A77A',Electrik:'#F7D02C',Combat:'#C22E28',Poison:'#A33EA1',Sol:'#E2BF65',Vol:'#A98FF3',Psy:'#F95587',Insecte:'#A6B91A',Roche:'#B6A136',Spectre:'#735797',Dragon:'#6F35FC',T√©n√®bres:'#705746',Acier:'#B7B7CE',F√©e:'#D685AD',Glace:'#96D9D6',Inconnu:'#334155'};
const fMap = { alola:"üèùÔ∏è Alola", deoxys:"üß¨ Deoxys", galar:"üõ°Ô∏è Galar", gmax:"üî• Gigamax", hisui:"üìú Hisui", mega:"‚ú® M√©ga", motisma:"üîå Motisma", paldea:"üçá Paldea", crown:"üëë Supr√™me" };

const formNames = {
    'mega-x': 'M√©ga X', 'mega-y': 'M√©ga Y',
    'deoxys-attack': 'Attaque', 'deoxys-defense': 'D√©fense', 'deoxys-speed': 'Vitesse',
    'rotom-heat': 'Chaleur', 'rotom-wash': 'Lavage', 'rotom-frost': 'Froid', 'rotom-fan': 'H√©lice', 'rotom-mow': 'Tonte',
    'tauros-paldea-combat-breed': 'Combat', 'tauros-paldea-blaze-breed': 'Flamboyante', 'tauros-paldea-aqua-breed': 'Aquatique',
    'zacian-crowned': '√âp√©e Supr√™me', 'zamazenta-crowned': 'Bouclier Supr√™me', 'eternatus-eternamax': 'Infinimax'
};

/** INITIALISATION */
async function init() {
    const box = document.getElementById('filter-box');
    Object.keys(fMap).sort().forEach(k => {
        const d = document.createElement('div'); d.className='chip'; d.innerText=fMap[k];
        d.onclick=()=>{ 
            activeFilter=(activeFilter===k)?null:k; 
            document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active')); 
            if(activeFilter) d.classList.add('active'); 
            currentPage=1; render(); 
        };
        box.appendChild(d);
    });

    for(let i=1; i<=1025; i++) {
        allPk.push({ id: i, name: `N¬∞${i}`, types: [], img: `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${i}.png`, isV: false });
    }
    render();

    // Chargement par paquets
    for (let i = 0; i < allPk.length; i += 50) {
        const batch = allPk.slice(i, i + 50);
        await Promise.all(batch.map(async (p) => {
            if (p.isV) return;
            try {
                const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${p.id}`).then(r => r.json());
                const spec = await fetch(res.species.url).then(r => r.json());
                p.name = spec.names.find(n => n.language.name === 'fr')?.name || res.name;
                p.types = res.types.map(t => tMap[t.type.name] || t.type.name);

                for(const v of spec.varieties) {
                    if(v.is_default) continue;
                    const vId = v.pokemon.url.split('/').filter(Boolean).pop();
                    const vRes = await fetch(v.pokemon.url).then(r => r.json());
                    const vn = v.pokemon.name.toLowerCase();
                    let tag = null, sub = null;

                    if(vn.includes('alola')) tag = 'alola';
                    else if(vn.includes('galar')) tag = 'galar';
                    else if(vn.includes('hisui')) tag = 'hisui';
                    else if(vn.includes('paldea')) tag = 'paldea';
                    else if(vn.includes('mega-x')) { tag = 'mega'; sub = 'M√©ga X'; }
                    else if(vn.includes('mega-y')) { tag = 'mega'; sub = 'M√©ga Y'; }
                    else if(vn.includes('mega')) { tag = 'mega'; sub = 'M√©ga'; }
                    else if(vn.includes('eternamax')) { tag = 'gmax'; sub = "Infinimax"; }
                    else if(vn.includes('gmax')) tag = 'gmax';
                    else if(vn.includes('crowned')) { tag = 'crown'; sub = formNames[vn] || 'Supr√™me'; }
                    else if(vn.includes('deoxys-')) { tag = 'deoxys'; sub = formNames[vn] || vn.split('-')[1]; }
                    else if(vn.includes('rotom-')) { tag = 'motisma'; sub = formNames[vn] || vn.split('-')[1]; }

                    if(tag) {
                        // Sp√©cificit√© Tauros
                        if(p.name === "Tauros" && tag === "paldea") sub = formNames[vn] || "Paldea";
                        
                        allPk.push({ 
                            id: vId, parentId: p.id, name: p.name, subName: sub, 
                            types: vRes.types.map(t => tMap[t.type.name] || t.type.name),
                            img: vRes.sprites.other['official-artwork'].front_default || vRes.sprites.front_default, 
                            isV: true, vType: tag 
                        });
                    }
                }
            } catch(e){}
        }));
        if(currentPage === 1) render();
    }
}

/** RENDU */
function render() {
    const query = document.getElementById('search').value.toLowerCase();
    const region = document.getElementById('region').value;
    
    let filtered = allPk.filter(p => {
        const nameMatch = p.name.toLowerCase().includes(query) || (p.subName && p.subName.toLowerCase().includes(query));
        
        // Anti-doublon : Si on cherche par nom, on ne montre la forme de base qu'une fois
        if(activeFilter) return p.vType === activeFilter && nameMatch;
        if(query.length > 1) return nameMatch;
        
        // Mode Index : On cache les formes alternatives complexes
        if(p.isV && p.id > 10000) return false;

        let regM = true;
        if(region !== 'all') {
            const [min, max] = region.split('-').map(Number);
            const bId = p.parentId || p.id;
            regM = (bId >= min && bId <= max);
        }
        return nameMatch && regM;
    });

    filtered.sort((a,b) => (a.parentId || a.id) - (b.parentId || b.id));

    // Suppression physique des doublons ID pour la grille finale
    const unique = [];
    const seen = new Set();
    filtered.forEach(p => {
        if(!seen.has(p.id)) { unique.push(p); seen.add(p.id); }
    });

    const grid = document.getElementById('grid');
    grid.innerHTML = unique.slice((currentPage-1)*perPage, currentPage*perPage).map(p => {
        const c1 = cMap[p.types[0]] || '#334155', c2 = p.types[1] ? cMap[p.types[1]] : c1;
        return `<div class="card" style="background:linear-gradient(135deg, ${c1} 50%, ${c2} 50%)" onclick="openM(${p.id}, '${p.subName ? p.name + ' ('+p.subName+')' : p.name}')">
            ${p.subName ? `<div class="form-label">${p.subName}</div>` : ''}
            <img src="${p.img}" loading="lazy" onerror="this.src='https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/0.png'">
            <div class="card-info">
                <h3 style="margin:5px 0; font-size:1.1rem; color:white;">${p.name}</h3>
                <div>${p.types.map(t => `<span class="type-tag" style="background:${cMap[t]}">${t}</span>`).join('')}</div>
                ${p.vType ? `<div style="font-size:0.6rem; margin-top:5px; font-weight:900; color:var(--accent);">SPECIMEN ${p.vType.toUpperCase()}</div>` : `<div style="opacity:0.5; font-size:0.75rem;">ID #${p.id}</div>`}
            </div>
        </div>`;
    }).join('');

    document.getElementById('st-total').innerText = unique.length;
    renderPagination(unique.length);
}

function renderPagination(totalCount) {
    const total = Math.ceil(totalCount / perPage);
    const pag = document.getElementById('pagination'); pag.innerHTML = "";
    if(total <= 1) return;
    for(let i=Math.max(1, currentPage-2); i<=Math.min(total, currentPage+2); i++){
        const b = document.createElement('div'); b.className=`p-btn ${i===currentPage?'active':''}`; b.textContent=i;
        b.onclick=()=>{currentPage=i; render(); window.scrollTo(0,400);}; pag.appendChild(b);
    }
}

async function openM(id, name) {
    const box = document.getElementById('m-content');
    document.getElementById('modal').style.display = "flex";
    box.innerHTML = "D√âCODAGE...";
    try {
        const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`).then(r => r.json());
        const spec = await fetch(res.species.url).then(r => r.json());
        const cat = spec.genera.find(g => g.language.name === 'fr')?.genus || "Inconnu";
        const desc = spec.flavor_text_entries.find(e => e.language.name === 'fr')?.flavor_text.replace(/\f/g, ' ') || "Aucune donn√©e.";
        sImg = { n: res.sprites.other['official-artwork'].front_default, s: res.sprites.other['official-artwork'].front_shiny || res.sprites.front_shiny, is: false };
        box.innerHTML = `
            <h2 style="color:var(--accent); margin:0; font-size:2.4rem;">${name}</h2>
            <div style="color:#94a3b8; font-weight:bold; letter-spacing:1px; margin-bottom:15px;">${cat}</div>
            <div style="display:flex; justify-content:center; gap:15px; margin-bottom:20px;">
                <div style="background:#1e293b; padding:10px 20px; border-radius:15px; border:1px solid rgba(255,255,255,0.1);"><small style="display:block; color:var(--accent); font-size:0.6rem; font-weight:900;">TAILLE</small><span style="font-weight:bold;">${res.height/10} m</span></div>
                <div style="background:#1e293b; padding:10px 20px; border-radius:15px; border:1px solid rgba(255,255,255,0.1);"><small style="display:block; color:var(--accent); font-size:0.6rem; font-weight:900;">POIDS</small><span style="font-weight:bold;">${res.weight/10} kg</span></div>
            </div>
            <button class="shiny-toggle" id="stog" onclick="toggleS()">‚ú® ANALYSE CHROMATIQUE</button><br>
            <img id="m-img" src="${sImg.n}" style="width:230px; margin:15px 0;">
            <p style="text-align:left; font-size:0.95rem; line-height:1.6; border-left:6px solid var(--accent); padding-left:25px; color:#94a3b8; margin-bottom:25px;">${desc}</p>
            <div style="text-align:left;">${res.stats.map(s=>`<div style="margin-bottom:12px;"><div style="display:flex; justify-content:space-between; font-size:0.7rem; font-weight:bold;"><span>${s.stat.name.toUpperCase()}</span><span>${s.base_stat}</span></div><div style="background:#1e293b; height:10px; border-radius:5px;"><div style="background:var(--accent); height:100%; width:${Math.min(s.base_stat/2, 100)}%;"></div></div></div>`).join('')}</div>`;
    } catch(e) { box.innerHTML = "ERREUR."; }
}

function resetAll() {
    document.getElementById('search').value = "";
    document.getElementById('region').value = "all";
    activeFilter = null;
    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
    currentPage = 1; render();
}

function toggleS() { sImg.is = !sImg.is; document.getElementById('m-img').src = sImg.is ? sImg.s : sImg.n; document.getElementById('stog').classList.toggle('active'); }
function showTab(id, btn) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active')); document.getElementById(id).classList.add('active'); btn.classList.add('active'); }

async function resetQuiz() {
    const img = document.getElementById('q-img');
    img.style.filter = "brightness(0)";
    document.getElementById('q-next').style.display = "none";
    const id = Math.floor(Math.random() * 800) + 1;
    try {
        const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`).then(r => r.json());
        const spec = await fetch(res.species.url).then(r => r.json());
        const correct = spec.names.find(n => n.language.name === 'fr').name;
        img.src = res.sprites.other['official-artwork'].front_default;
        let ch = [correct];
        while(ch.length < 4) { let n = allPk[Math.floor(Math.random()*1000)].name; if(n && !ch.includes(n) && !n.includes('N¬∞')) ch.push(n); }
        ch.sort(() => Math.random() - 0.5);
        document.getElementById('q-opts').innerHTML = ch.map(c => `<button style="padding:20px; background:#1e293b; color:white; border:1px solid #334155; border-radius:18px; cursor:pointer;" onclick="checkAnswer(this, '${c}', '${correct}')">${c}</button>`).join('');
    } catch(e) {}
}

function checkAnswer(btn, choice, correct) {
    btn.style.background = (choice === correct ? 'var(--accent)' : '#ef4444');
    document.getElementById('q-img').style.filter = 'brightness(1)';
    document.getElementById('q-next').style.display = 'block';
}

init();
</script>
</body>
</html>